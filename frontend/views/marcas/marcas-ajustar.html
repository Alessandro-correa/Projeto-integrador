<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="../../assets/css/style.css">
	<link rel="stylesheet" href="../../assets/css/forms.css">
	<title>Sistema Campos Moto Peças - Editar Marca</title>
</head>
<body>
	<section id="sidebar">
		<a href="../../views/dashboard/index.html" class="brand"><img src="../../assets/images/logo.png" alt="Campos Moto Peças"></a>
		<ul class="side-menu">
			<li><a href="../../views/dashboard/index.html"><i class='bx bxs-dashboard icon' ></i> Dashboard</a></li>
			<li class="divider" data-text="principal">Principal</li>
			<li><a href="../../views/os/os-consulta.html"><i class='bx bxs-notepad icon' ></i> Ordem de Serviço</a></li>
			<li><a href="../../views/orcamentos/orcamentos-consulta.html"><i class='bx bxs-calculator icon' ></i> Orçamentos</a></li>
			<li class="divider" data-text="gestão">Gestão</li>
			<li><a href="../../views/clientes/clientes-consulta.html"><i class='bx bxs-user-detail icon' ></i> Clientes</a></li>
			<li><a href="../motos/motos-consulta.html"><i class='bx bx-car icon'></i> Motocicletas</a></li>
			<li><a href="marcas-consulta.html" class="active"><i class='bx bxs-tag-alt icon'></i> Marcas</a></li>
			<li><a href="../../views/fornecedores/fornecedores-consulta.html"><i class='bx bxs-truck icon'></i> Fornecedores</a></li>
			<li><a href="../../views/pecas/pecas-consulta.html"><i class='bx bxs-wrench icon' ></i> Peças</a></li>
			<li><a href="../../views/usuarios/usuarios-consulta.html"><i class='bx bxs-shield-alt-2 icon' ></i> Usuários</a></li>
		</ul>
	</section>
	<section id="content">
		<nav>
			<i class='bx bx-menu toggle-sidebar' ></i>
			<div class="theme-toggle">
				<input type="checkbox" id="theme-toggle-checkbox">
				<label for="theme-toggle-checkbox" class="theme-toggle-label">
					<i class='bx bxs-sun'></i>
					<i class='bx bxs-moon'></i>
				</label>
			</div>
			<div class="profile">
				<a href="#" class="nav-link">
					<i class='bx bxs-log-out-circle icon' title="Sair"></i>
				</a>
			</div>
		</nav>
		<main>
			<h1 class="title">Ajustar Marca</h1>
			<ul class="breadcrumbs">
				<li><a href="../../index.html">Home</a></li>
				<li class="divider">/</li>
				<li><a href="marcas-consulta.html">Marcas</a></li>
				<li class="divider">/</li>
				<li><a href="#" class="active">Ajustar</a></li>
			</ul>
			<div class="data">
				<div class="content-data">
					<div class="head">
						<h3><i class='bx bx-edit'></i> Formulário de Ajuste da Marca</h3>
					</div>
					<form action="#" class="form-container os-form">
						<div class="form-section">
							<h3>Informações da Marca</h3>
							<div class="form-row">
								<div class="form-group">
									<label for="id">ID</label>
									<input type="text" id="id" disabled>
								</div>
								<div class="form-group">
									<label for="nome">Nome <span class="required">*</span></label>
									<input type="text" id="nome" name="nome" required placeholder="Nome da marca">
								</div>
							</div>
						</div>
						<div class="form-actions">
							<button type="button" onclick="window.location.href='marcas-consulta.html'" class="btn btn-secondary">
								<i class='bx bx-x'></i> Cancelar
							</button>
							<button type="submit" class="btn btn-primary">
								<i class='bx bx-check'></i> Salvar Alterações
							</button>
						</div>
					</form>
				</div>
			</div>
		</main>
	</section>
	<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
	<script type="module" src="../../assets/js/main.js"></script>
	<script>
document.addEventListener('DOMContentLoaded', async function() {
    const form = document.querySelector('form.os-form');
    const nomeInput = document.getElementById('nome');
    const idInput = document.getElementById('id');
    const submitBtn = form.querySelector('button[type="submit"]');

    function showNotification(message, type = 'info') {
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(notification => notification.remove());
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            max-width: 400px;
            display: flex;
            align-items: center;
            gap: 10px;
        `;
        const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle';
        notification.innerHTML = `
            <i class='bx bx-${icon}'></i>
            <span>${message}</span>
        `;
        document.body.appendChild(notification);
        setTimeout(() => {
            if (notification && notification.parentElement) {
                notification.remove();
            }
        }, 5000);
    }

    // Foco automático
    nomeInput.focus();

    // Obter o ID da marca da URL
    const urlParams = new URLSearchParams(window.location.search);
    const marcaId = urlParams.get('id');
    if (!marcaId) {
        showNotification('ID da marca não informado.', 'error');
        submitBtn.disabled = true;
        return;
    }

    // Carregar dados da marca
    try {
        const token = localStorage.getItem('token');
        const response = await fetch(`http://localhost:3000/api/marcas/${marcaId}`, {
            headers: { Authorization: `Bearer ${token}` }
        });
        const result = await response.json();
        if (result.success && result.data) {
            idInput.value = result.data.id;
            nomeInput.value = result.data.nome;
        } else {
            showNotification('Marca não encontrada.', 'error');
            submitBtn.disabled = true;
        }
    } catch (error) {
        showNotification('Erro ao carregar dados da marca.', 'error');
        submitBtn.disabled = true;
    }

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        const nome = nomeInput.value.trim();
        if (!nome) {
            showNotification('O nome da marca é obrigatório.', 'error');
            nomeInput.focus();
            return;
        }
        submitBtn.disabled = true;
        submitBtn.classList.add('loading');
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`http://localhost:3000/api/marcas/${marcaId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                body: JSON.stringify({ nome })
            });
            const result = await response.json();
            console.log('[Marca Edit] Resultado da API:', result);
            if (result.success) {
                showNotification('Marca atualizada com sucesso!', 'success');
                setTimeout(() => {
                    window.location.href = 'marcas-consulta.html';
                }, 1200);
            } else {
                showNotification(result.message || 'Erro ao atualizar marca.', 'error');
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            }
        } catch (error) {
            console.error('[Marca Edit] Erro na requisição:', error);
            showNotification('Erro ao atualizar marca.', 'error');
            submitBtn.disabled = false;
            submitBtn.classList.remove('loading');
        }
    });
});
</script>
</body>
</html> 