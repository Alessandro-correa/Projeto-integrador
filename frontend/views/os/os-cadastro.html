<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
	<link rel="stylesheet" href="../../assets/css/style.css">
	<link rel="stylesheet" href="../../assets/css/dashboard.css">
	<link rel="stylesheet" href="../../assets/css/template.css">
	<link rel="stylesheet" href="../../assets/css/forms.css">
	<link rel="stylesheet" href="../../assets/css/ajuste.css">
	<link rel="stylesheet" href="../../assets/css/os-ajuste.css">
	<style>
		/* Overlay para bloquear o formulário */
		.form-overlay {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(255, 255, 255, 0.8);
			z-index: 1000;
			display: none;
			align-items: center;
			justify-content: center;
			border-radius: 8px;
		}
		
		.form-overlay.active {
			display: flex;
		}
		
		.form-overlay-message {
			background: white;
			padding: 20px 30px;
			border-radius: 8px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
			text-align: center;
			border-left: 4px solid #dc3545;
		}
		
		.form-overlay-message h3 {
			margin: 0 0 10px 0;
			color: #dc3545;
			font-size: 18px;
		}
		
		.form-overlay-message p {
			margin: 0;
			color: #666;
			font-size: 14px;
		}
		
		/* Dark theme para overlay */
		body.dark .form-overlay {
			background: rgba(30, 30, 30, 0.8);
		}
		
		body.dark .form-overlay-message {
			background: var(--dark-surface);
			color: var(--dark-text-primary);
		}
		
		body.dark .form-overlay-message p {
			color: var(--dark-text-secondary);
		}
		
		/* Container precisa ser relativo para o overlay funcionar */
		.data {
			position: relative;
		}
		.form-container {
    width: 100% !important;
    max-width: none !important;
    margin: 0 !important;
    padding: 32px 32px 24px 32px !important;
    background: var(--light);
    border-radius: 12px;
    box-shadow: 0 2px 16px rgba(0,0,0,0.08);
}
@media (max-width: 800px) {
    .form-container {
        padding: 16px !important;
    }
}
	</style>
	<title>Sistema Campos Moto Peças - Nova Ordem de Serviço</title>
</head>
<body>
	<section id="sidebar">
		<a href="../../views/dashboard/index.html" class="brand"><img src="../../assets/images/logo.png" alt="Campos Moto Peças"></a>
		<ul class="side-menu">
			<li><a href="../dashboard/index.html"><i class='bx bxs-dashboard icon' ></i> Dashboard</a></li>
			<li class="divider" data-text="principal">Principal</li>
			<li><a href="os-consulta.html" class="active"><i class='bx bxs-notepad icon' ></i> Ordem de Serviço</a></li>
			<li><a href="../orcamentos/orcamentos-consulta.html"><i class='bx bxs-calculator icon' ></i> Orçamentos</a></li>
			<li class="divider" data-text="gestão">Gestão</li>
			<li><a href="../clientes/clientes-consulta.html"><i class='bx bxs-user-detail icon' ></i> Clientes</a></li>
			<li><a href="../motos/motos-consulta.html"><i class='bx bx-car icon'></i> Motocicletas</a></li>
			<li><a href="../marcas/marcas-consulta.html"><i class='bx bxs-tag-alt icon'></i> Marcas</a></li>
			<li><a href="../fornecedores/fornecedores-consulta.html"><i class='bx bxs-truck icon'></i> Fornecedores</a></li>
			<li><a href="../pecas/pecas-consulta.html"><i class='bx bxs-wrench icon'></i> Peças</a></li>
			<li><a href="../usuarios/usuarios-consulta.html"><i class='bx bxs-shield-alt-2 icon'></i> Usuários</a></li>
		</ul>
	</section>
	<section id="content">
		<nav>
			<i class='bx bx-menu toggle-sidebar' ></i>
			<div class="theme-toggle">
				<input type="checkbox" id="theme-toggle-checkbox">
				<label for="theme-toggle-checkbox" class="theme-toggle-label">
					<i class='bx bxs-sun'></i>
					<i class='bx bxs-moon'></i>
				</label>
			</div>
			<div class="profile">
				<a href="#" class="nav-link">
					<i class='bx bxs-log-out-circle icon' title="Sair"></i>
				</a>
			</div>
		</nav>
		<main>
			<h1 class="title">Ordem de Serviço</h1>
			<ul class="breadcrumbs">
				<li><a href="../../views/dashboard/index.html">Home</a></li>
				<li class="divider">/</li>
				<li><a href="os-consulta.html">Ordens de Serviço</a></li>
				<li class="divider">/</li>
				<li><a href="#" class="active">Nova O.S.</a></li>
			</ul>

			<!-- Notification Container -->
			<div id="notification-container" class="notification-container"></div>

			<!-- Alert Container -->
			<div id="alert-container"></div>

			<!-- Order Form Section -->
			<div class="data">
				<!-- Overlay para bloquear formulário -->
				<div id="form-overlay" class="form-overlay">
					<div class="form-overlay-message">
						<h3><i class='bx bx-lock-alt'></i> Formulário Bloqueado</h3>
						<p>Não é possível criar ordem de serviço para data futura.<br>Selecione a data de hoje ou uma data anterior.</p>
					</div>
				</div>
				
				<form id="cadastroForm" class="form-container">
					<div class="page-title">
						<h2><i class='bx bx-plus'></i> Formulário de Cadastro de Ordem de Serviço</h2>
					</div>
					<div class="form-section">
						<h3>Informações Básicas</h3>
						<div class="form-row">
							<div class="form-group">
								<label for="data_abertura">Data de Abertura <span class="required">*</span></label>
								<input type="date" id="data_abertura" name="data_abertura" required readonly>
							</div>
						</div>
						<div class="form-row">
							<div class="form-group">
								<label for="cliente_id">Cliente <span class="required">*</span></label>
								<select id="cliente_id" name="cliente_id" required>
									<option value="">Selecione o cliente...</option>
								</select>
							</div>
							<div class="form-group">
								<label for="motocicleta_id">Motocicleta <span class="required">*</span></label>
								<select id="motocicleta_id" name="motocicleta_id" required>
									<option value="">Selecione a motocicleta...</option>
								</select>
							</div>
						</div>
						<div class="form-group">
							<label for="titulo">Título do Serviço <span class="required">*</span></label>
							<input type="text" id="titulo" name="titulo" required placeholder="Título do serviço">
						</div>
					</div>
					<div class="form-section">
						<h3>Descrição e Status</h3>
						<div class="form-group">
							<label for="descricao">Descrição do Serviço <span class="required">*</span></label>
							<textarea id="descricao" name="descricao" rows="4" required placeholder="Descreva detalhadamente o serviço a ser realizado..."></textarea>
						</div>
						<div class="form-group">
							<label for="status">Status <span class="required">*</span></label>
							<select id="status" name="status" required>
								<option value="Aguardando Execução" selected>Aguardando Execução</option>
								<option value="Em Andamento">Em Andamento</option>
								<option value="Finalizada">Finalizada</option>
							</select>
						</div>
						<div class="form-group">
							<label for="observacoes">Observações</label>
							<textarea id="observacoes" name="observacoes" rows="3" placeholder="Observações adicionais sobre o serviço..."></textarea>
						</div>
					</div>
					<div class="form-section">
						<h3>Valor e Peças</h3>
						<div class="form-row">
							<div class="form-group">
								<label for="valor_mao_de_obra">Valor Mão de Obra <span class="required">*</span></label>
								<input type="number" id="valor_mao_de_obra" name="valor_mao_de_obra" step="0.01" min="0" required placeholder="0.00">
								<small class="form-text">Valor dos serviços executados</small>
							</div>
							<div class="form-group">
								<label for="valor_total">Valor Total das Peças</label>
								<input type="number" id="valor_total" name="valor_total" step="0.01" min="0" readonly placeholder="0.00">
								<small class="form-text">Calculado automaticamente a partir das peças</small>
							</div>
						</div>
						<div class="form-group">
							<label>Peças Utilizadas</label>
							<div class="pecas-header">
								<button type="button" id="addPecaBtn" class="btn btn-outline btn-sm">
									<i class='bx bx-plus'></i> Adicionar Peça
								</button>
							</div>
							<div id="pecas-container" class="pecas-container">
								<!-- Peças serão carregadas dinamicamente -->
							</div>
						</div>
					</div>
					<div class="form-actions">
						<button type="button" id="cancelBtn" class="btn btn-secondary">
							<i class='bx bx-x'></i> Cancelar
						</button>
						<button type="submit" id="saveBtn" class="btn btn-primary">
							<i class='bx bx-check'></i> Cadastrar OS
						</button>
					</div>
				</form>
			</div>
		</main>
	</section>

	<!-- Scripts -->
	<script src="../../src/components/SidebarController.js"></script>
	<script src="../../src/components/ThemeController.js"></script>
	<script src="../../src/components/OrdemCadastroController.js"></script>
	<script>
		// Inicializar controller da página apenas se não existir
		if (!window.ordemCadastroController) {
			window.ordemCadastroController = new OrdemCadastroController();
		}
	</script>
	<script>
document.addEventListener('DOMContentLoaded', function() {
    const dataInput = document.getElementById('data_abertura');
    if (dataInput) {
        const hoje = new Date();
        const yyyy = hoje.getFullYear();
        const mm = String(hoje.getMonth() + 1).padStart(2, '0');
        const dd = String(hoje.getDate()).padStart(2, '0');
        dataInput.value = `${yyyy}-${mm}-${dd}`;
    }
});
	</script>
	<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (!window.sidebarController) {
      window.sidebarController = new SidebarController();
      console.log('[SidebarController] Instanciado manualmente em os-cadastro.html');
    }
  });
</script>
</body>
</html>
